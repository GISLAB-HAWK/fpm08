```{=html}
<!--

Skripte für die Übungen 07 des Moduls FPM08 Forstliche Fernerkundung im Studiengang
B.Sc. Forstwirtschaft an der HAWK Göttingen.

Autor: Paul Magdon
Datum: 2025-11-16
Lizenz: Creative Commons BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/

-->
```

<<<<<<< HEAD
# Lerneinheit 07: Waldtypenklassifikation im Nationalpark Harz {#sec-Bildklassifikation}
=======
# Lerneinheit 07: Waldtypenklassifikation im Nationalpark Harz {#sec-le07}
>>>>>>> 3ea409c6be327f8bb4c135b27285692bb05901ef

![](images/LE07_cover_image.png){fig-align="center"}

## Lernziele & Aufgabenstellung

In dieser Übung soll für den Nationalpark Harz eine einfache Waldtypenkarte für das Jahr 2025
erstellt werden. Dazu werden aktuelle Satellitenbilder des Satellitensystems Sentinel-2
automatisiert mit einem überwachten Klassifikationsverfahren klassifiziert.

::: callout-note
Die Übung dient der Demonstration der grundlegenden Prinzipien der überwachten Bildklassifikation.
Es ist nicht das Ziel eine genaue Waldtypenkarte für spätere Auswertungen zu erstellen. Dies würde
ein deutlich höherer Aufwand erfordern, besonders bei der Auswahl von Trainingsgebieten, und somit
den zeitlichen Rahmen dieser Übung sprengen.
:::

**Lernziele**

Die Studierenden sollen:

-   Trainingsdaten für Bildklassifikationen anzulegen
-   Maschinelle Lernverfahren zum Erstellen von Klassifikationsmodellen zu nutzen
-   Mithilfe von trainierten Klassifikationsmodellen Satellitenbilder klassifizieren um einfache
    Landbedeckungskarten zu erstellen.

**Aufgaben**

1.  Raster- und Vektordaten importieren
2.  Ergänzung von Trainingsdaten durch visuelle Interpretation von Ortholuftbildern
3.  Trainings eines RandomForest Klassifikationsmodells
4.  Klassifikation eines S2-Satellitenbilds zur Erstellung einer Waldtypenkarte

## Aufgabe 0: Anlegen eine neuen QGIS-Projektes

Folgen sie der Anleitung aus LE01 @sec-projekt_management um eine neue Ordnerstruktur und ein neues
QGIS-Projekt für LE07 anzulegen. In der Übung bietet es sich an den Ordner *"daten"* weiter in die
Unterordner *"vektor"* und "raster" zu unterteilen.

## Aufgabe 01: Download und Import der Geodaten

### Rasterdaten

#### **Satellitenbilder**

In dieser Übung sollen aktuelle Sentinel-2 Satellitenbilder für die Klassifikation verwendet werden.
In LE04 @sec-le04 haben wir bereits eine Satellitenbildkarte angelegt und die entsprechenden
Sententinel-2 Bilder beschafft und vorbereitet. Kopieren Sie sich das Bild *NP_Harz_2025_06_12.tif*
aus der Übung LE04 in den "daten" Ordner der akuellen Übung (LE07). Sollten sie keinen Zugriff auf
dieses Bild mehr haben, können sie es sich alternativ hier herunterladen:

<https://cloud.hawk.de/index.php/s/2Hmncq99dxSoE3W>

Bei dem Bild handelt es sich um ein Sentine-2 Satellitenbild vom 12.06.2025 mit folgenden vier
Bändern:

-   Band 1 (blau)
-   Band 2 (grün)
-   Band 3 (rot)
-   Band 4 (Nahes Infrarot, NIR)

Importieren sie die Satellitenbild in ihr QGIS-Projekt und erzeugen sie eine
CIR-Falschfarbendarstellung (siehe auch LE02 @sec-CIR_darstellung). Achten sie darauf "0" als
Nullwert zu setzen. Führen sie anschließend eine Kontraststreckung mit einer zweifachen mittleren
Standardabweichung durch.

#### **Luftbilder**

Für die Erstellung der Trainingsdaten sollen Luftbilder mit einer höheren räumlichen Auflösung
genutzt werden. Da der Nationalpark Harz in zwei Bundesländern liegt müssen von beiden Bundesländern
entsprechende DOP-Bilder als WMS eingebunden werden (siehe dazu auch LE03 @sec-wms). Nutzen sie hier
für folgende Links:

Sachsen-Anhalt:

DOP-WMS:

`https://www.geodatenportal.sachsen-anhalt.de/wss/service/ST_LVermGeo_DOP_WMS_OpenData/guest?`

DOP-Aktualität:

`https://www.geodatenportal.sachsen-anhalt.de/wss/service/ST_LVermGeo_DOP_WMS_Kacheluebersicht/guest?`

Niedersachsen:

DOP:

`https://opendata.lgln.niedersachsen.de/doorman/noauth/dop_wms>`

**Fragen:**

::: {style="border: 3px solid #ff8a0b; background-color: #ffffff; padding: 8px;"}
1.  *Welche räumliche Auflösung hat das Satellitenbild?*
2.  *Welche radiometrische Auflösung hat das Satellitenbild?*
3.  Wann wurden das Satellitenbild und wann die Luftbilder in Sachsen-Anhalt und Niedersachsen
    aufgenommen?
:::

### Vektordaten

Für die Übung werden zwei Vektordatensätze benötigt:

1.) Grenzen des Nationalparkharz die sie hier herunterladen können:

<https://cloud.hawk.de/index.php/s/Hs52DFGtPnfKzyN>

2.) Vorbereiteter Referenzdatensatz mit Polygonen der verschiedenen Waldtypen

<https://cloud.hawk.de/index.php/s/ox2CsrEDHNjiiyF>

Für die Darstellung der unterschiedlichen Waldtypen wurde bereits eine QGIS-Stylefile angelegt das
sie hier herunterladen können:

<https://cloud.hawk.de/index.php/s/QZiSkR5Sd9Q5SdH>

Importieren sie die Vektordaten und passen sie die Darstellung der Referenzdaten entsprechend des
vorgegeben Stils an.

## Aufgabe 02: Ergänzung der Referenzdaten

### Klassifikationschlüssel

Der Klassifikationsschlüssel legt fest, welche Landbedeckungs-/Landnutzungsklassen in der
thematischen Karte erfasst werden sollen. Er enthält üblicherweise auch eine detaillierte
Beschreibung wie die einzelnen Klassen definiert sind und wie sie erfasst werden sollen. Für diese
Übung soll eine einfache Unterscheidung von drei Waldtypen und einer Hintergrundklasse ausreichend
sein:

| Name              | Erläuterung                  | ID  |
|-------------------|------------------------------|-----|
| Nadelholz         | Lebende, vitale Nadelgehölze | 1   |
| stehendes Totholz | Stehende tote Bäume          | 2   |
| Laubholz          | Lebende, vitale Laubgehölze  | 3   |
| Freiflächen       | Flächen ohne stehende Bäume  | 4   |

### Trainingsdaten ergänzen

Um eine überwachte Bildklassifikation durchführen zu können werden Referenzdaten benötigt. Die
Referenzdaten dienen zur Parametrisierung des Klassifkationsmodells, bzw. bei nicht-parametrischen
Verfahren zum Trainieren des Klassifikationsmodells. Die Anlage der Referenzdaten hat dabei eine
enorme Bedeutung für die Qualität der Klassifizierung und der daraus resultierenden thematischen
Karte. Es ist daher wichtig eine ausreichende Anzahl qualitativ hochwertiger Referenzdaten
vorzubereiten. Für die Übung heute möchten wir uns aus Zeitgründen jedoch auf 25 Flächen pro Klasse
beschränken. Die Auswahl und Anlage der Gebiete erfolgt dabei rein subjektiv -visuell.

Der Layer Referenzdaten im Geopackage *uebung07.gpkg* enthält bereits für alle vier Klassen des
Klassifikationsschlüssels jeweils 20 Polygone als Trainingsdaten. Ergänzen sie den Datensatz um
jeweils fünf weitere typische Beispiele der Klassen. Nutzen sie dafür die das Sentinel-2 Bild und
die Luftbilder aus den beiden Bundesländern. Achten sie dabei auf folgende Aspekte:

-   die Trainingsdaten sollten verteilt über das ganze Gebiet des NP liegen

-   als Trainingsdaten sollten Gebiete gewählt werden die eindeutige der jeweiligen Klasse
    zugeordnet werden können.

-   die Trainingsdaten sollten die Variabillität der Spektralbereiche der jeweiligen Klassen
    möglichst abdecken

## Aufgabe 03: Training eines Klassifikationsmodells {#sec-rf_training}

Im ersten Schritt müssen wir das Klassifikationsmodell mithilfe der Trainingsdaten „anlernen“. OTB
stellt dazu die Funktion *„TrainImageClassifier“* zur Verfügung, die wir in der Werkzeugkiste der
Verarbeitungsfunktionen über die Suche finden können. In dieser Funktion setzen wir die folgenden
Optionen:

-   **Input Image List**: Hier geben wir unser Sentinel2-Bild des NP-Harz an

-   **Input Vector Data**: Hier wählen wir das geopackage mit den Referenzdaten.

-   **Field containing the class integer label for supervision**: Hier wählen wir das Feld “Klasse”
    aus.

-   **Classifier to use for the training**: OTB bietet sehr viele Klassifikationsverfahren an, die
    alle mit dieser Funktion trainiert werden können. Für die Übung wählen wir „rf“ für „Random
    Forests“.

-   **Output model**: Hier geben wir an wo das trainierte Klassifikationsmodell gespeichert werden
    soll. Wir wählen *„rf_harz_2025.modell“* im Ordner *"daten"*.

-   **Output confusion matrix or contingency table**: Hier können wir eine Datei angeben in dem die
    Fehlermatrix gespeichert wird. Wir wählen *„rf_harz_2025.cm“* im Ordner *"daten".*

    ![TrainImageClassifier](images/LE07_trainclassifier.png)

    Alle anderen Optionen lassen wir unverändert und starten das Training. Je nach gewähltem
    Algorithmus und der Anzahl und Größe der Trainingsdaten kann dieser Prozess einige Minuten
    dauern. Wenn alles funktioniert hat, werden einige Statistiken zur Beurteilung der
    Modellgenauigkeit im Protokollfenster ausgegeben:

    ![](images/LE07_TrainImageClassifier_protocoll.png)

In Ordner "daten" befinden sich nun zwei neue Dateien: i) die Modelldatei mit dem trainierten
Klassifikationsmodell und eine Fehlermatrix. Letzter werden wir in der nächsten Lehreinheit
besprechen.

## Aufgabe 04: Klassifikation eines S2-Satellitenbilds zur Erstellung einer Waldtypenkarte

Nachdem wir das *RandomForest* Klassifikationsmodell trainiert haben, können wir es auf das gesamte
Satellitenbild anwenden, um jedem Pixel eine unsere vier thematischen Klassen zuzuweisen. Dazu
verwenden wir die OTB-Funktion *ImageClassifier* die im Werkzeugkasten der Verarbeitungsfunktionen
zu finden ist. Hier werden folgende Optionen gewählt.

-   **Input Image List**: Hier geben wir unser Sentinel2-Bild

-   **Model file**: Wir geben das vorher trainierte Modell *„rf_harz_2025.modell“* an.

-   **Output pixel type**: uint8

Alle anderen Optionen lassen wir unverändert und starten die Bildklassifikation. Je nach gewähltem
Algorithmus und der Bildgröße kann dieser Prozess einige Minuten dauern. Nach erfolgreicher
Klassifikation wird das Bild als Graustufenbild im QGIS geladen. Prüfen sie jetzt nochmal, ob das
Koordinatenrefenerzsystem des Projektes immer noch korrekt ist. Falls nicht ändern sie es
entsprechend.

Anschließend schneiden wir das klassifizierte Bild auf auf die Grenzen des Nationalparks zu (siehe
dazu auch LE04 @sec-zuschneiden). Das zugeschnittene Bild wird als GeoTif unter *"daten/
NP_Harz_2025_06_12_Waldtypen.tif"* gespeichert. Für die bessere Darstellung sollen die Farbwerte der
Pixel identisch zu den Farben im Referenzdatensatz sein. Erstellen sie dafür eine entsprechende
Symbolisierung.

**Fragen:**

::: {style="border: 3px solid #ff8a0b; background-color: #ffffff; padding: 8px;"}
1.  *Vergleichen sie die thematische Karte mit dem Satellitenbild.  Was fällt Ihnen auf?*
2.  *Bei welchen thematischen Klassen funktioniert die Klassifikation besser, bei welchen
    schlechter?*
3.  *Gibt es Bildbereiche/Regionen, in denen die Klassifikation genauer zu sein scheint?*
:::
